<map version="0.9.0">
<!-- To view this file, download free mind mapping software FreeMind from http://freemind.sourceforge.net -->
<node CREATED="1410055275242" ID="ID_1934580266" MODIFIED="1413594071338" STYLE="bubble" TEXT="Redis&#x6e90;&#x7801;&#x9605;&#x8bfb;">
<node CREATED="1410055349655" HGAP="126" ID="ID_1042413360" MODIFIED="1413594124973" POSITION="right" STYLE="bubble" TEXT="&#x5185;&#x90e8;&#x6570;&#x636e;&#x7ed3;&#x6784;" VSHIFT="-89">
<node CREATED="1410055391903" HGAP="187" ID="ID_489889611" MODIFIED="1413594125881" TEXT="dict" VSHIFT="-31">
<node CREATED="1410055419641" HGAP="48" ID="ID_1141185547" MODIFIED="1410055986560" VSHIFT="-149">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b>&#23383;&#20856;&#32467;&#26500;</b>
    </p>
    <p>
      struct dict {
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;dictType *type;
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;void *privdata;
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;dictht ht[2];
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;int rehashidx;&#160;&#160;//rehashidx&#65281;=-1&#24403;&#21069;&#27809;&#26377;&#20877;hash
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;int iterators;
    </p>
    <p>
      }
    </p>
  </body>
</html></richcontent>
<node CREATED="1410055638499" HGAP="88" ID="ID_288230619" MODIFIED="1410166559105" VSHIFT="-43">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b>&#23383;&#20856;&#20869;Hash&#34920;&#32467;&#26500;</b>
    </p>
    <p>
      struct dictht {
    </p>
    <p>
      &#160;&#160;&#160;&#160;dictEntry **table; //Hash&#34920;&#33410;&#28857;&#30340;&#25351;&#38024;&#25968;&#32452;
    </p>
    <p>
      &#160;&#160;&#160;&#160;unsigned long size; //&#25351;&#38024;&#25968;&#25454;&#30340;&#22823;&#23567;
    </p>
    <p>
      &#160;&#160;&#160;&#160;unsigned long sizemask; //&#25351;&#38024;&#25968;&#32452;&#30340;&#38271;&#24230;&#25513;&#30721;
    </p>
    <p>
      &#160;&#160;&#160;&#160;unsigned long used; //Hash&#34920;&#29616;&#26377;&#33410;&#28857;&#30340;&#25968;&#37327;
    </p>
    <p>
      }
    </p>
  </body>
</html></richcontent>
<node CREATED="1410055866836" HGAP="81" ID="ID_707009500" MODIFIED="1410056048847" VSHIFT="-76">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b>&#23383;&#20856;&#27599;&#19968;&#20010;&#38190;&#20540;&#23384;&#20648;&#32467;&#26500;</b>
    </p>
    <p>
      struct dictEntry {
    </p>
    <p>
      &#160;&#160;&#160;&#160;void *key;
    </p>
    <p>
      &#160;&#160;&#160;&#160;union {
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;void *val;
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;uint64_t u64;
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;int64_t s64;
    </p>
    <p>
      &#160;&#160;&#160;&#160;} v;
    </p>
    <p>
      &#160;&#160;&#160;&#160;struct dictEntry *next;
    </p>
    <p>
      }
    </p>
  </body>
</html></richcontent>
</node>
</node>
</node>
<node CREATED="1410056484101" HGAP="62" ID="ID_1721079041" MODIFIED="1410167996107" STYLE="fork" VSHIFT="-33">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b>tips </b>
    </p>
    <p>
      1. Hash&#34920;&#30340;&#22823;&#23567;&#26159;2&#30340;&#27425;&#24130;
    </p>
    <p>
      2. dictht&#20013;size&#30340;&#22823;&#23567;&#23567;&#20110;used&#30340;&#22823;&#23567;&#36825;&#20010;Hash&#34920;&#26159;&#26080;&#25928;&#30340;
    </p>
    <p>
      3. &#28176;&#36827;&#24335;Hash
    </p>
    <p>
      4. &#26597;&#25214;&#19968;&#20010;key&#22914;&#26524;&#27491;&#22312;rehash&#21017;&#20004;&#20010;Hash&#34920;&#37117;&#26597;&#25214;&#21542;&#21017;&#21482;
    </p>
    <p>
      &#26816;&#26597;&#31532;&#19968;&#20010;Hash&#34920;.
    </p>
    <p>
      5. &#28155;&#21152;key&#26102;&#22914;&#26524;&#27491;&#22312;rehash&#21017;&#30452;&#25509;&#22312;Hash&#34920;1&#19978;&#28155;&#21152;&#65292;&#21542;&#22312;
    </p>
    <p>
      &#22312;Hash&#34920;0&#19978;&#28155;&#21152;.
    </p>
    <p>
      6.<b>rehash&#30340;&#26465;&#20214; ratio = used / size </b>
    </p>
    <p>
      <b>&#160;&#160;&#160;&#160;1) &#33258;&#28982;rehash: ratio &gt;= 1, &#19988;&#21464;&#37327;dict_can_resize&#20026;&#30495; </b>
    </p>
    <p>
      <b>&#160;&#160;&#160;&#160;2) &#24378;&#21046;rehash: ratio&#22823;&#20110;&#21464;&#37327;dict_force_resize_ratio&#160;&#160;(&#24403;&#21069;&#20026;5) </b>
    </p>
    <p>
      7.rehash&#30340;&#36807;&#31243;
    </p>
    <p>
      &#160;&#160;&#160;&#160;1) &#21019;&#24314;&#19968;&#20010;&#27604;ht[0]-&gt;table&#26356;&#22823;&#30340;ht[1]-&gt;table
    </p>
    <p>
      &#160;&#160;&#160;&#160;2) &#23558;ht[0]-&gt;table&#20013;&#30340;&#25152;&#26377;&#38190;&#20540;&#23545;&#36801;&#31227;&#21040;ht[1]-&gt;table
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#28176;&#36827;&#24335;rehash: rehash&#26159;&#20998;&#22810;&#27493;&#36827;&#34892;&#65292;&#24182;&#19981;&#26159;&#31435;&#21363;&#25191;&#34892;&#65292;&#31435;&#21363;&#23436;&#25104;
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;* _dictRehashStep: &#20877;&#23545;&#23383;&#20856;&#36827;&#34892;&#35775;&#38382;&#25805;&#20316;&#26102;&#25191;&#34892;&#19968;&#27493;&#36801;&#31227;
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;* dictRehashMilliseconds: &#30001;Redis&#24120;&#35268;&#26381;&#21153;&#22120;&#25191;&#34892;&#25351;&#23450;&#27627;&#31186;&#25968;&#30340;&#36801;&#31227;
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;rehash&#36807;&#31243;&#20013;&#30340;&#26597;&#25214;&#21644;&#21024;&#38500;&#25805;&#20316;&#22312;&#20004;&#20010;hash&#34920;&#19978;&#37117;&#35201;&#25191;&#34892;
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#28155;&#21152;&#25805;&#20316;&#30452;&#25509;&#22312;hash&#34920;1&#19978;&#25191;&#34892;
    </p>
    <p>
      &#160;&#160;&#160;&#160;3) &#23558;&#21407;&#26377;ht[0]&#30340;&#25968;&#25454;&#28165;&#31354;, &#24182;&#23558;ht[1]&#26367;&#25442;&#20026;&#26032;&#30340;ht[0]
    </p>
    <p>
      8.&#23383;&#20856;&#25910;&#32553;: &#24403;&#23383;&#20856;&#30340;&#22635;&#20805;&#29575;&#23567;&#20110;10%&#26102;&#25191;&#34892;&#23383;&#20856;&#25910;&#32553;&#65292;&#25910;&#32553;&#36807;&#31243;&#31867;&#20284;&#20110;rehash&#30340;&#36807;&#31243;&#65292;&#27599;&#27425;&#22312;
    </p>
    <p>
      &#160;&#160;&#160;&#21024;&#38500;&#20803;&#32032;&#26102;&#25191;&#34892;&#25910;&#32553;&#26816;&#27979;&#36807;&#31243;.
    </p>
  </body>
</html></richcontent>
<node CREATED="1410163753122" ID="ID_931293813" MODIFIED="1410165009646">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b>tips </b>
    </p>
    <p>
      1.sds&#25552;&#20379;&#23545;char*&#31867;&#22411;&#30340;&#23553;&#35013;&#65292;&#25552;&#20379;&#23545;&#23383;&#31526;&#20018;&#19968;&#20123;&#24120;&#29992;&#25805;&#20316;.
    </p>
    <p>
      2.char*&#23545;&#24212;&#23383;&#31526;&#20018;&#38271;&#24230;&#25805;&#20316;&#22797;&#26434;&#24230;&#20026;O(N)
    </p>
    <p>
      3.&#23545;sds&#36827;&#34892;append&#26102;&#26032;&#30340;&#38271;&#24230;&#23567;&#20110;&#39044;&#20998;&#37197;&#38271;&#24230;&#26102;&#65292;sds&#38271;&#24230;&#20493;&#22686;,
    </p>
    <p>
      &#160;&#160;&#160;&#21542;&#21017;&#30452;&#25509;&#22686;&#21152;&#26368;&#22823;&#39044;&#20998;&#37197;&#38271;&#24230;&#65292;&#24403;&#21069;&#26368;&#22823;&#39044;&#20998;&#37197;&#38271;&#24230;&#20026;1M(SDS_MAX_PREALLOC)
    </p>
    <p>
      4.<b>sds&#29305;&#28857;: 1)&#39640;&#25928;&#38271;&#24230;&#35745;&#31639; 2)&#39640;&#25928;&#36861;&#21152; 3)&#20108;&#36827;&#21046;&#23433;&#20840;</b>
    </p>
  </body>
</html></richcontent>
</node>
</node>
<node CREATED="1410166276095" HGAP="16" ID="ID_723199405" MODIFIED="1410166356318" VSHIFT="81">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#29992;&#36884;:
    </p>
    <p>
      1.&#38190;&#31354;&#38388;
    </p>
    <p>
      2.Hash&#31867;&#22411;&#30340;&#24213;&#23618;&#23454;&#29616;
    </p>
  </body>
</html></richcontent>
</node>
</node>
<node CREATED="1410163606930" HGAP="188" ID="ID_1914336849" MODIFIED="1413594141893" TEXT="sds" VSHIFT="124">
<node CREATED="1410164034820" HGAP="44" ID="ID_945660313" MODIFIED="1410164363361" VSHIFT="69">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      sds&#32467;&#26500;
    </p>
    <p>
      struct sdshdr {
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;int len; //buf&#24050;&#21344;&#29992;&#38271;&#24230;
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;int free; //buf&#21097;&#20313;&#21487;&#29992;&#38271;&#24230;
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;char buf[]; //&#23454;&#38469;&#20445;&#23384;&#25968;&#25454;
    </p>
    <p>
      }
    </p>
  </body>
</html></richcontent>
</node>
</node>
<node CREATED="1410165127942" HGAP="194" ID="ID_1816398888" MODIFIED="1413594143684" TEXT="adlist(&#x53cc;&#x7aef;&#x5217;&#x8868;)" VSHIFT="101">
<node CREATED="1410165233648" HGAP="34" ID="ID_500895177" MODIFIED="1410165595459" VSHIFT="-180">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      list&#32467;&#26500;
    </p>
    <p>
      struct list {
    </p>
    <p>
      &#160;&#160;&#160;&#160;listNode *head; //&#22836;&#25351;&#38024;
    </p>
    <p>
      &#160;&#160;&#160;&#160;listNode *tail; //&#23614;&#25351;&#38024;
    </p>
    <p>
      &#160;&#160;&#160;&#160;unsigned long len; //&#33410;&#28857;&#30340;&#25968;&#37327;
    </p>
    <p>
      &#160;&#160;&#160;&#160;void *(*dup)(void *ptr); //&#22797;&#21046;&#20989;&#25968;
    </p>
    <p>
      &#160;&#160;&#160;&#160;void (*free)(void*free); //&#37322;&#25918;&#20989;&#25968;
    </p>
    <p>
      &#160;&#160;&#160;&#160;int (*match)(void *ptr, void *key); //&#23545;&#27604;&#20989;&#25968;
    </p>
    <p>
      }
    </p>
  </body>
</html></richcontent>
<node CREATED="1410165415885" HGAP="52" ID="ID_1962943286" MODIFIED="1410165498628" VSHIFT="-62">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      listNode&#32467;&#26500;
    </p>
    <p>
      struct listNode {
    </p>
    <p>
      &#160;&#160;&#160;&#160;struct listNode *prev;
    </p>
    <p>
      &#160;&#160;&#160;&#160;struct listNode *next;
    </p>
    <p>
      &#160;&#160;&#160;&#160;void *value;
    </p>
    <p>
      }
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1410165608992" HGAP="49" ID="ID_920582450" MODIFIED="1410165722610" VSHIFT="5">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      listIter&#36845;&#20195;&#22120;&#32467;&#26500;
    </p>
    <p>
      struct {
    </p>
    <p>
      &#160;&#160;&#160;&#160;listNode *next;
    </p>
    <p>
      &#160;&#160;&#160;&#160;int direction;
    </p>
    <p>
      }
    </p>
    <p>
      direction: 1) AL_START_HEAD &#20174;&#22836;&#21040;&#23614;&#160;&#160;2) AL_START_TAIL &#20174;&#23614;&#21040;&#22836;
    </p>
  </body>
</html></richcontent>
</node>
</node>
<node CREATED="1410165245386" ID="ID_8129189" MODIFIED="1410166144374">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      tips:
    </p>
    <p>
      1.O(1)&#22797;&#26434;&#24230;&#35775;&#38382;&#21069;&#39537;&#21644;&#21518;&#32487;&#65292; &#21487;&#29992;&#20174;&#22836;&#25110;&#32773;&#20174;&#23614;&#36827;&#34892;&#36941;&#21382;
    </p>
    <p>
      2.&#20445;&#23384;&#39318;&#23614;&#25351;&#38024;&#65292;O(1)&#22797;&#26434;&#24230;&#26041;&#20301;&#39318;&#23614;&#20803;&#32032;
    </p>
    <p>
      3.O(1)&#22797;&#26434;&#24230;&#33719;&#21462;&#38271;&#24230;
    </p>
  </body>
</html></richcontent>
</node>
</node>
<node CREATED="1410168017741" HGAP="189" ID="ID_1484356471" MODIFIED="1413594145979" TEXT="zskiplist(&#x8df3;&#x8dc3;&#x8868;)" VSHIFT="107">
<node CREATED="1410168078984" HGAP="42" ID="ID_530439974" MODIFIED="1410168165969" VSHIFT="-102">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b>zskiplist&#32467;&#26500;</b>
    </p>
    <p>
      struct zskiplist {
    </p>
    <p>
      &#160;&#160;&#160;&#160;struct zskiplistNode *header, *tail;&#160;&#160;//&#22836;&#32467;&#28857;&#21644;&#23614;&#33410;&#28857;
    </p>
    <p>
      &#160;&#160;&#160;&#160;unsigned long length; //&#33410;&#28857;&#25968;&#37327;
    </p>
    <p>
      &#160;&#160;&#160;&#160;int level;&#160;&#160;&#160;&#30446;&#21069;&#34920;&#33410;&#28857;&#30340;&#26368;&#22823;&#23618;&#25968;
    </p>
    <p>
      }
    </p>
  </body>
</html></richcontent>
<node CREATED="1410168170703" ID="ID_1109479614" MODIFIED="1410168471186">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b>zskiplistNode&#32467;&#26500;</b>
    </p>
    <p>
      struct zskiplistNode {
    </p>
    <p>
      &#160;&#160;&#160;&#160;robj *obj;&#160;&#160;//&#25104;&#21592;&#23545;&#35937;
    </p>
    <p>
      &#160;&#160;&#160;&#160;double score; //&#20998;&#20540;
    </p>
    <p>
      &#160;&#160;&#160;&#160;struct zskiplistNode *backward; //&#21518;&#36864;&#25351;&#38024;
    </p>
    <p>
      &#160;&#160;&#160;&#160;struct zskiplistLevel {
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;struct zskiplistNode *forward; //&#21069;&#36827;&#25351;&#38024;
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;unsigned int span; //&#36825;&#20010;&#23618;&#36328;&#36234;&#30340;&#33410;&#28857;&#25968;&#37327;
    </p>
    <p>
      &#160;&#160;&#160;&#160;} level[];
    </p>
    <p>
      } zskiplistNode;
    </p>
  </body>
</html></richcontent>
</node>
</node>
<node CREATED="1410168084864" ID="ID_107898602" MODIFIED="1410168628792">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      tips:
    </p>
    <p>
      1.&#36339;&#36291;&#34920;&#26159;&#19968;&#31181;&#38543;&#26426;&#25968;&#25454;&#32467;&#26500;,&#26597;&#25214;&#65292;&#22686;&#21152;&#65292;&#21024;&#38500;&#25805;&#20316;&#37117;&#33021;&#22312;&#23545;&#25968;&#26399;&#26395;&#26102;&#38388;&#19979;&#23436;&#25104;&#12290;
    </p>
    <p>
      2.&#35813;&#36339;&#36291;&#34920;&#23454;&#29616;&#65292;&#23545;&#20256;&#32479;&#36339;&#36291;&#34920;&#20570;&#20102;&#22914;&#19979;&#25913;&#21160;
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;1) score&#20540;&#21487;&#37325;&#22797;
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;2) &#23545;&#27604;&#19968;&#20010;&#20803;&#32032;&#35201;&#21516;&#26102;&#26816;&#26597;&#23427;&#30340;score&#21644;member
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;3) &#27599;&#20010;&#33410;&#28857;&#24102;&#26377;&#39640;&#24230;&#20026;1&#23618;&#30340;&#21518;&#36864;&#25351;&#38024;, &#29992;&#25143;&#20174;&#34920;&#23614;&#26041;&#21521;&#24819;&#34920;&#22836;&#36845;&#20195;
    </p>
  </body>
</html></richcontent>
</node>
</node>
</node>
<node CREATED="1410171571250" FOLDED="true" HGAP="190" ID="ID_1470526009" MODIFIED="1413594122325" POSITION="right" STYLE="bubble" VSHIFT="-67">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b>&#20869;&#23384;&#26144;&#23556;&#25968;&#25454;&#32467;&#26500; </b>
    </p>
    <p>
      &#19968;&#31995;&#21015;&#32463;&#36807;&#29305;&#27530;&#32534;&#30721;&#30340;&#23383;&#33410;&#24207;&#21015;&#65292;&#19982;&#20869;&#37096;&#25968;&#25454;&#32467;&#26500;&#30456;&#27604;&#36739;
    </p>
    <p>
      &#38750;&#24120;&#33410;&#30465;&#20869;&#23384;&#65292;&#20294;&#26159;&#28040;&#32791;&#19968;&#23450;&#30340;CPU,&#24403;&#19968;&#20010;&#23545;&#35937;&#21253;&#21547;&#30340;&#20803;&#32032;
    </p>
    <p>
      &#25968;&#37327;&#19981;&#22810;&#65292;&#25110;&#32773;&#20803;&#32032;&#26412;&#36523;&#20307;&#31215;&#19981;&#22823;&#26102;&#65292;&#21487;&#20197;&#20351;&#29992;&#20869;&#37096;&#26144;&#23556;
    </p>
    <p>
      &#25968;&#25454;&#32467;&#26500;
    </p>
  </body>
</html></richcontent>
<node CREATED="1410171906399" FOLDED="true" HGAP="68" ID="ID_1348139736" MODIFIED="1410172625213" VSHIFT="-79">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b>&#25972;&#25968;&#38598;&#21512;</b>
    </p>
    <p>
      &#29992;&#20110;&#20445;&#23384;&#26377;&#24207;,&#26080;&#37325;&#22797;&#30340;&#20445;&#23384;&#22810;&#20010;&#25972;&#25968;&#20540;&#65292;&#26681;&#25454;&#20803;&#32032;&#30340;&#20540;,
    </p>
    <p>
      &#33258;&#21160;&#36873;&#25321;&#35813;&#29992;&#20160;&#20040;&#38271;&#24230;&#30340;&#25972;&#25968;&#31867;&#22411;&#26469;&#20445;&#23384;&#20803;&#32032;.
    </p>
    <p>
      &#26681;&#25454;&#21152;&#20837;&#20803;&#32032;&#30340;&#26368;&#22823;&#38271;&#24230;&#36827;&#34892;&#33258;&#21160;&#21319;&#32423;
    </p>
    <p>
      &#25972;&#25968;&#31867;&#22411;&#26377;: int16_t, int32_t, int64_t
    </p>
  </body>
</html></richcontent>
<node CREATED="1410172086063" HGAP="46" ID="ID_854024533" MODIFIED="1410172298748" VSHIFT="-115">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      intset&#32467;&#26500;
    </p>
    <p>
      struct intset{
    </p>
    <p>
      &#160;&#160;&#160;&#160;uint32_t encoding; //&#20445;&#23384;&#20803;&#32032;&#25152;&#20351;&#29992;&#30340;&#31867;&#22411;&#30340;&#38271;&#24230;
    </p>
    <p>
      &#160;&#160;&#160;&#160;uint32_t length; //&#20803;&#32032;&#30340;&#20010;&#25968;
    </p>
    <p>
      &#160;&#160;&#160;&#160;int8_t contents[]; //&#20445;&#23384;&#20803;&#32032;&#30340;&#25968;&#32452;;
    </p>
    <p>
      };
    </p>
    <p>
      
    </p>
    <p>
      <b>encoding&#23450;&#20041;&#20540;&#20026;</b>
    </p>
    <p>
      #define INTSET_ENC_INT16 (sizeof(int16_t))
    </p>
    <p>
      #define INTSET_ENC_INT32 (sizeof(int32_t))
    </p>
    <p>
      #define INTSET_ENC_INT64 (sizeof(int64_t))
    </p>
    <p>
      &#20013;&#30340;&#19968;&#20010;
    </p>
    <p>
      
    </p>
    <p>
      <b>contents&#20013;&#30340;&#20803;&#32032;&#26080;&#37325;&#22797;&#65292;&#20174;&#23567;&#21040;&#22823;</b>
    </p>
    <p>
      
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1410172495032" ID="ID_1468380170" MODIFIED="1410172597631">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      tips:
    </p>
    <p>
      1.&#21319;&#32423;&#20250;&#24341;&#36215;&#25972;&#20010;intset&#36827;&#34892;&#20869;&#23384;&#37325;&#26032;&#20998;&#37197;, &#24182;&#31227;&#21160;&#38598;&#21512;&#20013;&#30340;&#25152;&#26377;&#20803;&#32032;&#65292;&#36825;&#20010;&#25805;&#20316;&#22797;&#26434;&#24230;&#20026;O(N)
    </p>
    <p>
      2.Intset&#21482;&#25903;&#25345;&#21319;&#32423;&#65292;&#19981;&#25903;&#25345;&#38477;&#32423;
    </p>
    <p>
      3.intset&#26377;&#24207;&#65292;&#26597;&#25214;&#20351;&#29992;&#20108;&#20998;&#26597;&#25214;
    </p>
  </body>
</html></richcontent>
</node>
</node>
<node CREATED="1410171916134" ID="ID_393338053" MODIFIED="1410172989231">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#21387;&#32553;&#21015;&#34920;
    </p>
    <p>
      &#19968;&#31995;&#21015;&#29305;&#27530;&#32534;&#30721;&#30340;&#20869;&#23384;&#24555;&#26500;&#25104;&#30340;&#21015;&#34920;,&#19968;&#20010;ziplist&#21487;&#20197;&#21253;&#21547;&#22810;&#20010;&#33410;&#28857;(entry)
    </p>
    <p>
      &#27599;&#20010;&#33410;&#28857;&#21487;&#20197;&#20445;&#23384;&#19968;&#20010;&#38271;&#24230;&#21463;&#38480;&#30340;&#23383;&#31526;&#25968;&#25454;&#25110;&#32773;&#25972;&#25968;
    </p>
  </body>
</html></richcontent>
</node>
</node>
<node CREATED="1410173025266" HGAP="188" ID="ID_835086675" MODIFIED="1413594168493" POSITION="right" STYLE="bubble" VSHIFT="-46">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      Redis&#25968;&#25454;&#31867;&#22411;
    </p>
  </body>
</html></richcontent>
<node CREATED="1410173260428" HGAP="47" ID="ID_1247597697" MODIFIED="1410174052008" VSHIFT="-58">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b>redisObject&#25968;&#25454;&#32467;&#26500;</b>
    </p>
    <p>
      struct redisObject {
    </p>
    <p>
      &#160;&#160;&#160;&#160;unsigned type:4;&#160;&#160;&#160;//&#31867;&#22411;
    </p>
    <p>
      &#160;&#160;&#160;&#160;unsigned encoding:4; //&#32534;&#30721;
    </p>
    <p>
      &#160;&#160;&#160;&#160;unsigned lru:REDIS_LRU_BITS: //&#23545;&#35937;&#26368;&#21518;&#19968;&#27425;&#35775;&#38382;&#26102;&#38388;
    </p>
    <p>
      &#160;&#160;&#160;&#160;int refcount; //&#24341;&#29992;&#35745;&#25968;
    </p>
    <p>
      &#160;&#160;&#160;&#160;void *ptr; //&#23454;&#38469;&#23545;&#35937;&#25351;&#38024;
    </p>
    <p>
      }
    </p>
    <p>
      
    </p>
    <p>
      <b>&#31867;&#22411;type&#21487;&#21462;REDIS_STRING, REDIS_LIST, REDIS_SET, REDIS_ZSET, REDIS_HASH </b>
    </p>
    <p>
      &#32534;&#30721;&#31867;&#22411;&#26377;:
    </p>
    <p>
      REDIS_ENCODING_RAW&#160;&#160;&#160;&#160;//&#32534;&#30721;&#20026;&#23383;&#31526;&#20018;
    </p>
    <p>
      REDIS_ENCODING_INT&#160;&#160;&#160;&#160;&#160;&#160;//&#32534;&#30721;&#20026;&#25972;&#25968;
    </p>
    <p>
      REDIS_ENCODING_HT&#160;&#160;&#160;&#160;&#160;&#160;&#160;//&#32534;&#30721;&#20026;&#21704;&#24076;&#34920;
    </p>
    <p>
      REDIS_ENCODING_ZIPMAP//&#32534;&#30721;&#20026;zipmap
    </p>
    <p>
      REDIS_ENCODING_LINKEDLIST //&#32534;&#30721;&#20026;&#21452;&#31471;&#21015;&#34920;
    </p>
    <p>
      REDIS_ENCODING_ZIPLIST //&#32534;&#30721;&#20026;&#21387;&#32553;&#21015;&#34920;
    </p>
    <p>
      REDIS_ENCODING_INTSET //&#32534;&#30721;&#20026;&#25972;&#25968;&#38598;&#21512;
    </p>
    <p>
      REDIS_ENCODING_SKIPLIST //&#32534;&#30721;&#20026;&#36339;&#36291;&#34920;
    </p>
    <p>
      
    </p>
    <p>
      Redis&#20351;&#29992;&#33258;&#24049;&#23454;&#29616;&#30340;&#23545;&#35937;&#26426;&#21046;&#23454;&#29616;&#31867;&#22411;&#21028;&#26029;&#65292;&#21629;&#20196;&#22810;&#24577;&#21644;&#22522;&#20110;&#24341;&#29992;&#35745;&#25968;&#30340;&#22403;&#22334;&#22238;&#25910;
    </p>
    <p>
      &#19968;&#31181;Redis&#31867;&#22411;&#30340;&#38190;&#21487;&#20197;&#26377;&#22810;&#31181;&#24213;&#23618;&#23454;&#29616;
    </p>
    <p>
      Redis&#20250;&#39044;&#20998;&#37197;&#19968;&#20123;&#24120;&#29992;&#30340;&#25968;&#25454;&#23545;&#35937;&#65292; &#24182;&#36890;&#36807;&#20849;&#20139;&#26469;&#20943;&#23569;&#20869;&#23384;&#21344;&#29992;&#21644;&#36991;&#20813;&#23567;&#23545;&#35937;&#30340;&#39057;&#32321;&#20998;&#37197;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1410225377370" HGAP="49" ID="ID_975205611" MODIFIED="1410226115024" VSHIFT="-1">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b>&#21704;&#24076;&#34920;</b>
    </p>
    <p>
      &#24213;&#23618;&#23454;&#29616;
    </p>
    <p>
      1) &#21387;&#32553;&#21015;&#34920;&#160;&#160;REDIS_ENCODING_ZIPLIST
    </p>
    <p>
      &#160;&#38190;&#21644;&#20540;&#39034;&#24207;&#23384;&#25918;
    </p>
    <p>
      2) &#23383;&#20856;&#160;&#160;REDIS_ENCODING_HT
    </p>
    <p>
      
    </p>
    <p>
      <b>&#32534;&#30721;&#36873;&#25321;</b>
    </p>
    <p>
      &#21019;&#24314;&#31354;&#21704;&#24076;&#34920;&#40664;&#35748;&#20351;&#29992;&#21387;&#32553;&#21015;&#34920;&#32534;&#30721;,&#24403;&#28385;&#36275;&#22914;&#19979;&#20043;&#19968;&#26465;&#20214;,&#23558;&#36716;&#21270;&#20026;&#23383;&#20856;
    </p>
    <p>
      1) &#21704;&#24076;&#34920;&#20013;&#26576;&#20010;&#38190;&#25110;&#32773;&#26576;&#20010;&#20540;&#30340;&#38271;&#24230;&#22823;&#20110;server.hash_max_ziplist_value (&#40664;&#35748;: 64)
    </p>
    <p>
      2) &#21387;&#32553;&#21015;&#34920;&#20013;&#30340;&#33410;&#28857;&#25968;&#37327;&#22823;&#20110;server.hash_max_ziplist_entries (&#40664;&#35748;: 512)
    </p>
    <p>
      &#160;&#160;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1410226108431" HGAP="51" ID="ID_1600136244" MODIFIED="1410227081344" VSHIFT="76">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b>&#21015;&#34920;</b>
    </p>
    <p>
      &#24213;&#23618;&#23454;&#29616;
    </p>
    <p>
      1) &#21387;&#32553;&#21015;&#34920; REDIS_ENCODING_ZIPLIST
    </p>
    <p>
      2) &#21452;&#31471;&#38142;&#34920; REDIS_ENCODING_LINKEDLIST
    </p>
    <p>
      
    </p>
    <p>
      <b>&#32534;&#30721;&#36873;&#25321;</b>
    </p>
    <p>
      &#21019;&#24314;&#26032;&#21015;&#34920;&#40664;&#35748;&#20351;&#29992;&#21387;&#32553;&#21015;&#34920;,&#24403;&#28385;&#36275;&#22914;&#19979;&#20043;&#19968;&#26465;&#20214;&#65292;&#36716;&#25442;&#20026;&#21452;&#31471;&#38142;&#34920;
    </p>
    <p>
      1) &#21015;&#34920;&#20013;&#26032;&#21152;&#20837;&#30340;&#23383;&#31526;&#20018;&#20540;&#65292;&#19988;&#20540;&#30340;&#38271;&#24230;&#36229;&#36807; server.list_max_ziplist_value (&#40664;&#35748;: 64)
    </p>
    <p>
      2) &#21387;&#32553;&#21015;&#34920;&#20013;&#33410;&#28857;&#25968;&#37327;&#22823;&#20110;server.list_max_ziplist_entries (&#40664;&#35748;: 512)
    </p>
    <p>
      
    </p>
    <p>
      <b>&#38459;&#22622;</b>
    </p>
    <p>
      &#38459;&#22622;&#21407;&#35821;: BLPOP, BRPOP, BRPOPLPUSH
    </p>
    <p>
      &#24403;&#19968;&#20010;&#38459;&#22622;&#28304;&#20110;&#22788;&#29702;&#30340;&#30446;&#26631;&#20026;&#31354;&#26102;&#65292;&#25191;&#34892;&#21407;&#35821;&#30340;&#23458;&#25143;&#31471;&#23558;&#20250;&#34987;&#38459;&#22622;
    </p>
    <p>
      &#38459;&#22622;&#23458;&#25143;&#31471;&#27493;&#39588;
    </p>
    <p>
      1).&#23558;&#23458;&#25143;&#31471;&#29366;&#24577;&#35774;&#20026;'&#27491;&#22312;&#38459;&#22622;', &#24182;&#35760;&#24405;&#38459;&#22622;&#36825;&#20010;&#23458;&#25143;&#31471;&#30340;&#21508;&#20010;&#38190;, &#20197;&#21450;&#38459;&#22622;&#26368;&#38271;&#26102;&#38480;
    </p>
    <p>
      2).&#23558;&#23458;&#25143;&#31471;&#30340;&#20449;&#24687;&#35760;&#24405;&#22312;server.db[i]-&gt;blocking_keys&#20013;
    </p>
    <p>
      3).&#32500;&#25345;&#23458;&#25143;&#31471;&#19982;&#26381;&#21153;&#22120;&#20043;&#38388;&#32593;&#32476;&#36830;&#25509;&#65292;&#20294;&#19981;&#22312;&#21521;&#23458;&#25143;&#31471;&#20256;&#36865;&#20219;&#20309;&#20449;&#24687;, &#36896;&#25104;&#23458;&#25143;&#31471;&#38459;&#22622;
    </p>
    <p>
      
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1410227093803" HGAP="48" ID="ID_1930073662" MODIFIED="1410227586685" VSHIFT="13">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#38598;&#21512;
    </p>
    <p>
      &#24213;&#23618;&#26102;&#38480;
    </p>
    <p>
      1) &#25972;&#25968;&#38598;&#21512;&#160;&#160;REDIS_ENCODING_INTSET
    </p>
    <p>
      2) &#23383;&#20856; REDIS_ENCODING_HT
    </p>
    <p>
      
    </p>
    <p>
      &#32534;&#30721;&#36873;&#25321;
    </p>
    <p>
      &#31532;&#19968;&#20010;&#21152;&#20837;&#30340;&#20803;&#32032;&#20915;&#23450;&#21019;&#24314;&#38598;&#21512;&#26102;&#20351;&#29992;&#30340;&#32534;&#30721;
    </p>
    <p>
      1) &#31532;&#19968;&#20010;&#21152;&#20837;&#30340;&#20803;&#32032;&#20026;&#25972;&#25968;, &#37027;&#20040;&#21021;&#22987;&#21270;&#32534;&#30721;&#20026;&#25972;&#25968;&#38598;&#21512;
    </p>
    <p>
      2) &#21542;&#21017;&#38598;&#21512;&#30340;&#21021;&#22987;&#32534;&#30721;&#20026;&#23383;&#20856;
    </p>
    <p>
      3) intset&#20445;&#23384;&#30340;&#25972;&#25968;&#20540;&#36229;&#36807;server.set_max_intset_entries (&#40664;&#35748;512) &#25110;&#32773; &#24448;&#38598;&#21512;&#20013;&#28155;&#21152;&#19968;&#20010;&#26032;&#20803;&#32032;&#36825;&#20010;&#20803;&#32032;&#19981;&#33021;&#36716;&#25442;&#20026;&#25972;&#25968;&#37027;&#20040;&#65292;&#38598;&#21512;&#30340;&#32534;&#30721;&#23558;&#20174;&#25972;&#25968;&#38598;&#21512;&#36716;&#25442;&#20026;&#23383;&#20856;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1410227588312" HGAP="48" ID="ID_1517179078" MODIFIED="1410228419995" VSHIFT="62">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b>&#26377;&#24207;&#38598;</b>
    </p>
    <p>
      &#24213;&#23618;&#23454;&#29616;
    </p>
    <p>
      1) &#21387;&#32553;&#21015;&#34920; REDIS_ENCODING_ZIPLIST
    </p>
    <p>
      &#27599;&#20010;&#26377;&#24207;&#38598;&#21512;&#20013;&#30340;&#20803;&#32032;&#20197;&#30456;&#37051;&#30340;ziplist&#33410;&#28857;&#34920;&#31034;,&#31532;&#19968;&#20010;&#33410;&#28857;&#20445;&#23384;&#20803;&#32032;&#30340;member&#22495;
    </p>
    <p>
      &#31532;&#20108;&#20010;&#33410;&#28857;&#20445;&#23384;score&#22495;&#65292; &#22810;&#20010;&#20803;&#32032;&#20043;&#38388;&#25353;&#29031;score&#20540;&#20174;&#23567;&#21040;&#22823;&#25490;&#24207;, &#22914;&#26524;score&#30456;&#21516;
    </p>
    <p>
      &#21017;&#25353;&#29031;&#23383;&#20856;&#24207;&#23545;member&#36827;&#34892;&#23545;&#27604;,&#20915;&#23450;&#21738;&#20010;&#20803;&#32032;&#25490;&#22312;&#21069;&#38754;&#21738;&#20010;&#20803;&#32032;&#25490;&#22312;&#21518;&#38754;.
    </p>
    <p>
      2) &#36339;&#36291;&#34920; REDIS_ENCODING_SKIPLIST
    </p>
    <p>
      
    </p>
    <p>
      <b>&#32534;&#30721;&#36873;&#25321;</b>
    </p>
    <p>
      &#31532;&#19968;&#27425;&#21152;&#20837;&#20803;&#32032;,&#28385;&#36275;&#22914;&#19979;&#26465;&#20214;&#21019;&#24314;&#21387;&#32553;&#21015;&#34920;&#32534;&#30721;
    </p>
    <p>
      1) &#26381;&#21153;&#22120;&#23646;&#24615;server.zset_max_ziplist_entries&#22823;&#20110;0 &#65288;&#40664;&#35748;128)
    </p>
    <p>
      2) &#20803;&#32032;&#30340;&#38271;&#24230;&#23567;&#20110;&#26381;&#21153;&#22120;&#23646;&#24615; server.zset_max_ziplist_value (&#40664;&#35748;64)
    </p>
    <p>
      
    </p>
    <p>
      <b>&#36716;&#30721;</b>
    </p>
    <p>
      &#24403;&#28385;&#36275;&#22914;&#19979;&#26465;&#20214;&#21017;&#32534;&#30721;&#36716;&#25442;&#20026;&#36339;&#36291;&#34920;
    </p>
    <p>
      1) ziplist&#25152;&#20445;&#23384;&#30340;&#20803;&#32032;&#25968;&#37327;&#36229;&#36807;&#26381;&#21153;&#22120;&#23646;&#24615;server.zset_max_ziplist_entries (&#40664;&#35748;128&#65289;
    </p>
    <p>
      2) &#26032;&#28155;&#21152;&#30340;&#20803;&#32032;&#38271;&#24230;&#22823;&#20110;&#26381;&#21153;&#22120;&#23646;&#24615;server.zset_max_ziplist_value (&#40664;&#35748;64)
    </p>
  </body>
</html></richcontent>
</node>
</node>
<node CREATED="1410228560462" HGAP="186" ID="ID_1073895485" MODIFIED="1413594155445" POSITION="right" VSHIFT="3">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b>&#20107;&#21153; </b>
    </p>
    <p>
      &#25805;&#20316;&#21629;&#20196; MULTI, DISCARD, EXEC, WATCH
    </p>
    <p>
      
    </p>
    <p>
      <b>&#22788;&#29702;&#27969;&#31243;</b>
    </p>
    <p>
      1) &#24320;&#22987;&#20107;&#21153; &#25191;&#34892;MULTI &#20999;&#25442;&#23458;&#25143;&#31471;&#29366;&#24577;
    </p>
    <p>
      2) &#21629;&#20196;&#20837;&#38431; &#25191;&#34892;&#27491;&#24120;&#21629;&#20196;&#65292;&#23558;&#21629;&#20196;&#25918;&#20837;&#20107;&#21153;&#38431;&#21015;
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#20107;&#21153;&#38431;&#21015;&#26159;&#19968;&#20010;&#25968;&#32452;, &#25968;&#32452;&#27599;&#39033;&#21253;&#21547;&#19977;&#20010;&#23646;&#24615;
    </p>
    <p>
      &#160;&#160;&#160;* &#35201;&#25191;&#34892;&#30340;&#21629;&#20196;
    </p>
    <p>
      &#160;&#160;&#160;* &#21629;&#20196;&#30340;&#21442;&#25968;
    </p>
    <p>
      &#160;&#160;&#160;* &#21442;&#25968;&#30340;&#20010;&#25968;
    </p>
    <p>
      3) &#25191;&#34892;&#20107;&#21153;
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#20107;&#21153;&#25191;&#34892;&#26159;&#20197;&#19968;&#20010;&#20107;&#21153;&#20026;&#21333;&#20301;&#65292;&#25191;&#34892;&#38431;&#21015;&#20013;&#30340;&#25152;&#26377;&#21629;&#20196;&#65306;&#38500;&#38750;&#24403;&#21069;&#20107;&#21153;&#25191;&#34892;&#23436;&#27605;&#65292;&#21542;&#21017;&#26381;&#21153;&#22120;&#19981;&#22238;&#20013;&#26029;&#20107;&#21153;&#65292;&#20063;&#19981;&#22238;&#25191;&#34892;&#20854;&#23427;&#23458;&#25143;&#31471;&#30340;&#21629;&#20196;&#65292;&#20107;&#21153;&#25191;&#34892;&#23436;&#25104;&#21518;&#25152;&#26377;&#21629;&#20196;&#25191;&#34892;&#30340;&#32467;&#26524;&#21516;&#26102;&#36820;&#22238;&#12290;
    </p>
    <p>
      
    </p>
    <p>
      WATCH&#21629;&#20196;&#29992;&#20110;&#22312;&#20107;&#21153;&#24320;&#22987;&#20043;&#21069;&#30417;&#25511;&#20219;&#24847;&#25968;&#37327;&#30340;&#38190;&#65292; &#24403;&#35843;&#29992;EXEC&#25191;&#34892;&#20107;&#21153;&#26102;&#65292; &#22914;&#26524;&#20219;&#24847;&#19968;&#20010;&#34987;&#30417;&#25511;&#30340;&#38190;&#24050;&#32463;&#34987;&#20854;&#20182;&#23458;&#25143;&#31471;&#20462;&#25913;&#65292;&#37027;&#20040;&#25972;&#20010;&#20107;&#21153;&#19981;&#20877;&#25191;&#34892;&#65292;&#30452;&#25509;&#36820;&#22238;&#22833;&#36133;
    </p>
    <p>
      
    </p>
  </body>
</html></richcontent>
</node>
</node>
</map>
